{% extends "../base.html" %}
{% block page_title %}注册|创业孵化平台{% end %}

{% block content %}
<script src="{{ static_url('js/passwordstrength.js') }}" type="text/javascript"></script>

<div class="content_width1" style="margin-bottom: 40px;position: relative;">
    <div class="register-head">
        <h1>忘记密码</h1>

        <div>
            已有账户，<a href="/login">马上登陆</a>
            <a href="/" style="color:#A3A3A3">返回网站首页</a>
        </div>
        <p class="clear"></p>
    </div>
    <div style="background: white;box-shadow: 0px 5px 5px #E0DEDF">

        <form id="form_reg">
            {% module xsrf_form_html() %}
            <table width="50%" cellspacing="0" cellpadding="0" border="0">
                <tr>
                    <td align="right"><span style="color:red">*</span>用户名：</td>
                    <td><input type="text" id="username" name="username" onkeyup="keydownfun()"
                               placeholder="4-16位字符，字母/中文/数字/下划线"/>
                        <span></span>
                    </td>
                </tr>
                <tr height="35"></tr>
                <tr>
                    <td align="right"><span style="color:red">*</span>密码：</td>
                    <td>
                        <input type="password" id="pwd" name="pwd" onKeyUp="ps.update(this.value);"
                               placeholder="6-16位字符，字母与数字组合"/>

                        <div class="pwdErrMsgDiv">
                            <div id="bottoms">
                                <div id="pss">
                                    <script language="javascript">
                                        var ps = new PasswordStrength();
                                        ps.setSize("110", "20");
                                        ps.setMinLength(6);
                                    </script>
                                    <span class="pwdErrMsg"></span>

                                    <p style="clear: both"></p>
                                </div>
                            </div>
                            <style>
                                .pwdErrMsgDiv {
                                    height: 0;
                                }

                                .pwdErrMsg {
                                    font-size: 15px;
                                }

                                .pwdErrMsg img {
                                    border: none;
                                    width: 15px;
                                    height: 15px;
                                    vertical-align: middle;
                                    margin-right: 5px;
                                }

                                #pss table {
                                    float: left;
                                    margin: 0;
                                    margin-right: 10px;;
                                }
                            </style>
                        </div>
                    </td>
                </tr>
                <tr height="35"></tr>
                <tr>
                    <td align="right"><span style="color:red">*</span>确认密码：</td>
                    <td><input type="password" id="pwd2" name="pwd2" placeholder="请再次输入密码"/>
                        <span></span></td>
                </tr>
                <tr height="35"></tr>
                <tr>
                    <td align="right"><span style="color:red">*</span>身份：</td>
                    <td>
                        <select name="role">
                            <option value="0">&emsp;普通用户</option>
                            <option value="1">&emsp;创客</option>
                            <option value="2">&emsp;投资人</option>
                            <option value="3">&emsp;评审</option>
                            <option value="5">&emsp;孵化器</option>
                            <option value="4">&emsp;技术团队</option>
                            <option value="6">&emsp;其他</option>
                        </select>
                        {#                        <input type="radio" name='role' value='0' selected='True' checked="checked"/><span>普通用户</span>#}
                        {#                        <input type="radio" name='role' value='1' selected='True' checked="checked"/><span>创客</span>#}
                        {#                        <input type="radio" name='role' value='2'/><span>投资人</span>#}
                        {#                        <input type="radio" name='role' value='3' selected='True' checked="checked"/><span>评审</span>#}
                        {#                        <input type="radio" name='role' value='4' selected='True' checked="checked"/><span>技术团队</span>#}
                        {#                        <input type="radio" name='role' value='5' selected='True' checked="checked"/><span>孵化器</span>#}
                        {#                        <input type="radio" name='role' value='6'/><span>其他</span>#}
                    </td>
                </tr>
                <tr height="35"></tr>
                <tr>
                    <td align="right">邮箱：</td>
                    <td><input type="text" id="email" name="email" placeholder="输入你的邮箱"/>
                        <span></span>
                    </td>
                </tr>
                <tr height="35"></tr>
                <tr>
                    <td align="right"><span style="color:red">*</span>手机号：</td>
                    <td><input type="text" id="phone" name="phone" maxlength="11" onkeyup="usertitle()"
                               placeholder="请输入您的手机号完成验证"/>
                        <span></span>
                    </td>
                </tr>
                <tr height="35"></tr>
                <tr>
                    <td align="right"><span style="color:red">*</span>短信验证码：</td>
                    <td style="line-height: 47px">
                        <input type="text" placeholder="" name='msgcode' id="msgcode" class="register-input1"/>
                        <a href="javascript:;" id="js-auth-code-btn">获取验证码</a>
                    </td>
                </tr>


                <tr height="35"></tr>
                <tr>
                    <td align="right"><span style="color:red">*</span>验证码：</td>
                    <td>
                        <input type="text" placeholder="" name='code' id="code" class="register-input2"
                               style="vertical-align:middle;"/>
                        <a href="javascript:refreshCode()" class="refreshCode">
                            <img src='/imagecode' id="imgcode" class="refreshCodeImg" title="单击下一张" alt="单击下一张">
                            <!--                           <a href="javascript:refreshCode()"> 换一张</a>-->
                        </a>
                    </td>
                </tr>
                <tr height="35"></tr>
                <tr>
                    <td></td>
                    <td>
                        <label style="position: relative"><input name="readme" type="checkbox"
                                                                 style="width: 20px;height: 20px;cursor: pointer;position: absolute;top: 0px;margin-right: 10px;"/>&emsp;&emsp;我已阅读并同意</label>
                        <a href="javascript:;" id="parkHatchBtn"">《创业孵化平台用户注册协议》</a><br/>
                        <a href="javascript:;" onclick="postmessage()" id="register">注册</a>
                    </td>
                </tr>
            </table>
        </form>

    </div>


</div>
<div class="_mask"></div>
<div class="_alert">
    <div class="parkHatchTitle" style="position: relative">
        用户服务协议
        <a href="javascript:;" style="position: absolute;top:-2px;right: -2px;font-size: 25px;" id="_cancel">×</a>
    </div>
    <div style="overflow-x: hidden;overflow-y: scroll;height: 90%">
        <h1 style="text-align: center;">创业孵化平台用户注册协议</h1>

        <p>&nbsp;</p>

        <p>双创学院众筹平台是一个实现梦想的平台，发起人可以在双创学院众筹平台上发起创新项目的筹款需求，并承诺提供不同形式的回报给支持创新项目的支持者。为保护支持者的合法权益，规范发起人的行为，维护众筹平台秩序，特拟定本协议。</p>

        <h2><b>第一条 协议内容及签署</b></h2>

        <p>1.1 本协议构成您与创业孵化平台站（包括但不限于www.vchits.com及双创学院众筹平台等）就网站使用服务所达成的协议。当您完成注册并在本服务协议前方“□”打√时，即表示您认可协议条款和条件，已同意受人人投网站网站服务协议约束，包括但不限于本协议及所有人人投网站已经发布的或将来可能发布的各类规则等。如果您不同意本协议，请不要在“□”打√，同时您将无权使用创业孵化平台站的服务。</p>
        <p>1.2 您应当在使用创业孵化平台站服务之前认真阅读全部协议内容。如您对协议有任何疑问的，可向创业孵化平台站咨询。但无论您事实上是否在使用创业孵化平台站服务之前认真阅读了本协议内容，只要您使用创业孵化平台站服务，则本协议即对您产生约束，届时您不应以未阅读本协议的内容或者未获得双创学院对您问询的解答等理由，主张本协议无效或要求撤销本协议。</p>
        <p>1.3 创业孵化平台站有权根据需要不时地制订、修改本协议或各类规则，并以网站公示的方式进行公告，不再单独通知您。变更后的协议和规则一经在网站公布后，即时生效。如您不同意相关变更，应当立即停止使用创业孵化平台站服务。如果您继续使用创业孵化平台站服务，即表示您接受经修订的协议和规则</p>
        <p>1.4 创业孵化平台站提供的网络服务的所有权和最终解释权归深圳市得瑟文化传媒有限公司所有。本协议中，被许可使用创业孵化平台站服务的注册会员均简称为“注册会员”。</p>
        <p>&nbsp;</p>

        <h2><b>第二条 服务内容</b></h2>

        <p>2.1 注册会员可以在网站上浏览公告、项目介绍、项目评论等网站开放信息，经过网站审核的认证投资人还可以查看项目内容页的详细信息、评论项目并进行在线投资</p>

        <p>2.2 注册会员有权在指定板块发布符合创业孵化平台站要求的信息。</p>

        <p>2.3 创业孵化平台站运用自己的操作系统通过互联网使得注册会员可以在创业孵化平台站上成功发布信息。</p>

        <p>&nbsp;</p>

        <h2><b>第三条 注册会员的权利与义务</b></h2>

        <p>3.1 注册会员有权在创业孵化平台站的指定版块发布符合规定的信息。</p>

        <p>3.2 注册会员有义务确保其发布、评论的信息符合中华人民共和国的法律法规及创业孵化平台站的相关规则的要求。</p>

        <p>3.3 注册会员有义务保证其向创业孵化平台站提交及发布的信息是真实有效的，并将承担由于发布错误信息而造成的损失。</p>

        <p>3.4 除非取得创业孵化平台站的事先书面同意。注册会员不得将其在本协议项下享有的权利与义务转让给任何第三方。</p>

        <p>&nbsp;</p>

        <h2><b>第四条 创业孵化平台站的权利和义务</b></h2>

        <p>4.1 创业孵化平台站将对每一个申请成为认证投资人的注册会员进行审核，并且有权拒绝注册会员申请成为认证投资人或者发布项目的要求。</p>

        <p>4.2 创业孵化平台站会竭力确保特定信息（比如项目内容页的详细信息）只对有查看权限的注册会员开放。</p>

        <p>&nbsp;</p>

        <h2><b>第五条 免责声明</b></h2>

        <p>5.1 创业孵化平台站仅为注册会员提供网络空间及技术服务，我们并不能完全确保注册会员提交的信息是完全无误的。</p>

        <p>5.2 如因创业孵化平台站系统维护或升级而需暂停服务时，将事先公告。若因线路故障及非本公司控制范围内的其他硬件故障或其它不可抗力而导致暂停服务，那么暂停服务期间造成的一切不便与损失，本网站不负任何责任。</p>

        <p>5.3 双创学院业务系统因下列状况无法正常运作，使您无法使用各项服务时，双创学院不承担损害赔偿责任，该状况包括但不限于：</p>

        <p>5.3.1 双创学院在门户网站公告之系统停机维护期间；</p>

        <p>5.3.2 服务器、电信设备、线路等硬件设施出现故障导致交易数据不能正常产生、传输；</p>

        <p>5.3.3 因台风、地震、海啸、洪水、停电、战争、恐怖袭击等不可抗力事件，导致双创学院系统障碍不能正常为您提供服务；</p>

        <p>5.3.4 由于黑客攻击、电力系统问题、电信部门技术调整等其他方非因双创学院自身所能控制原因而造成的服务中断或者延迟。</p>

        <p>5.4 本协议未涉及的问题参见国家有关法律法规，当本协议与国家法律法规冲突时，以国家法律法规为准。</p>

        <p>&nbsp;</p>

        <h2><b>第六条 隐私权政策及安全</b></h2>

        <p>6.1 创业孵化平台站尊重并保护所有注册会员的个人隐私权。为了给您提供更准确、更有个性化的服务，创业孵化平台站会按照本隐私权政策的规定使用和披露您的个人信息。但我们将以高度审慎的态度对待这些信息。除本隐私权政策另有规定外，在未征得您事先许可的情况下，创业孵化平台站不会将这些信息对外披露或向第三方提供。但以下状况除外：</p>

        <p>6.1.1 根据法律的有关规定，或者行政或司法机构的要求，向第三方或者行政、司法机构披露；</p>

        <p>6.1.2 如您出现违反中国有关法律、法规或相关规则的情况，需要向第三方披露；</p>

        <p>6.2 创业孵化平台站会不时更新本隐私权政策。</p>

        <p>6.3 为了更好地服务注册会员，创业孵化平台站可能通过使用您的个人信息，向您提供您感兴趣的信息。</p>

        <p>6.4 创业孵化平台站通过对注册会员登录密码进行加密等安全措施确保注册会员的隐私安全。</p>

        <p>&nbsp;</p>

        <h2><b>第七条 知识产权</b></h2>

        <p>7.1 注册会员的上传行为代表着注册会员或其代表的公司授权创业孵化平台站对上传的信息享有不可撤销的永久的使用权和收益权，但注册会员或其代表的公司仍保有上传信息的所属权。</p>

        <p>7.2 注册会员有义务确保其发布的信息不侵犯任何第三方知识产权及其他权利，否则由此给第三方及创业孵化平台站造成的损失将由注册会员承担。</p>

        <p>&nbsp;</p>

        <h2><b>第八条 法律适用及争议解决</b></h2>

        <p>8.1 本协议签署、效力、解释和执行以及争议之解决均应适用中国法律。</p>

        <p>8.2 对本协议任何条款的执行或解释所引起的任何争议，创业孵化平台站和注册会员应尽最大努力友好协商解决；协商不成的，双方均可向创业孵化平台站所在地的人民法院起诉</p>

        <p>&nbsp;</p>

        <h2><b>第九条 有效期及其他</b></h2>

        <p>9.1 本协议有效期自注册会员点击同意之日起至注册会员注销账号之日止。</p>

        <p>9.2 如本协议的任何条款被视作无效或无法执行，不影响其余条款的效力。</p>

        <p>9.3 本协议标题是为了方便阅读所设，并非是对条款的定义、限制和解释。</p>

    </div>
</div>
<style>
    ._mask{
        width: 100%;
        height: 100%;
        position: fixed;
        z-index: 10;
        background: rgba(0, 0, 0, 0.6);
        bottom: 0;
        display: none;
    }
    ._alert {
        position: fixed;
        z-index: 100;
        width: 655px;
        height: 600px;
        background: rgba(255, 255, 255, 1);
        border-radius: 8px;
        top: 40%;
        margin-top: -300px;
        left: 50%;
        margin-left: -367.5px;
        padding: 30px 40px;
        display: none;
    }
    ._alert h1{
        font-size: 18px;
        margin-top: 15px;
    }
    ._alert h2{
        font-size: 15px;
        color: #0079dd;
    }
    ._alert p{
        font-size: 14px;
        color:#666;
</style>
<script type="text/javascript">
    var data = {};

    function refreshCode() {
        document.getElementById("imgcode").src = "/imagecode?" + Math.random();
    }


    var arr = {};//装载每项资料的对错
    /*  用户名的验证*/
    function keydownfun() {
        var sttr = $("#username").val();
        {#        var srr = checkusername(sttr, /^[a-zA-Z]{1}([a-zA-Z0-9]|[_]){3,19}$/);#}
        var srr = checkusername(sttr, /^[\u4e00-\u9fa5a-zA-Z0-9_]{3,20}$/);
        arr['username'] = false;
        if (sttr == "") {
            $("#rwdata1 #rwpic").html('');
            $("#rwdata1 #rwtxt").text("");
            return;
        }
        if (srr == false) {
            $("#username + span").html('<img src="/static/img/wrong.png"/>用户名格式不对');
        } else {
            $("#username + span").html('<img src="/static/img/rightPic.png"/>用户名格式正确');
        }
        if (sttr.length < 4) {
            $("#username + span").html('<img src="/static/img/wrong.png"/>用户名长度小于4');

        }
        else if (sttr.length > 20) {
            $("#username + span").html('<img src="/static/img/wrong.png"/>用户名长度大于20');
        }

    }

    function checkusername(str, pat) {
        if (!str.match(pat)) return false;
        return true;
    }
    /*密码验证1*/
    function psskeydown1() {
        var sttr = $("#pwd").val();
        var srr = checkusername(sttr, /^([a-zA-Z0-9]){5,19}$/);
        var pwd = '.pwdErrMsg';
        arr['pwd1'] = srr;
        if (sttr == "") {
            $("#pwd + span").html('');
            $("#pwd + span").text("");
            return;
        }
        if (srr == false) {
            $(pwd).html('<img src="/static/img/wrong.png"/>密码格式错误');
            return;
        } else {
            $(pwd).html('<img src="/static/img/rightPic.png"/>');
        }
        if (sttr.length < 6) {
            $(pwd).html('<img src="/static/img/wrong.png"/>密码长度小于6');
        }
        else if (sttr.length > 20) {
            $(pwd).html('<img src="/static/img/wrong.png"/>密码长度大于20');
        }

    }
    /*密码验证2*/
    function psskeydown2() {
        var sttr = $("#pwd2").val();
        if (arr['pwd1'] == false || sttr == "") {
            arr['pwd2'] = false;
            $("#pwd2 + span").html('');
            $("#pwd2 + span").text("");
            return;
        }
        if (sttr != $("#pwd").val()) {
            arr['pwd2'] = false;
            $("#pwd2 + span").html('<img src="/static/img/wrong.png"/>两次输入的密码不一致');
        } else {
            arr['pwd2'] = true;
            $("#pwd2 + span").html('<img src="/static/img/rightPic.png"/>');
        }
    }
    /*email 后缀验证*/
    function email_ext(c) {
        var reg = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/; //验证邮箱的正则表达式
        if (!reg.test(c)) {
            $("#email + span").html('<img src="/static/img/wrong.png"/>邮箱格式不对');
            return false;
        }
    }
    function usertitle() {
        var sttr = $("#nick").val();
        var srr = checkusername(sttr, /^([u4e00-u9fa5]|[ufe30-uffa0]|[a-za-z0-9_]){3,12}$/);
        var sum = 0;
        arr['usertitle'] = false;
        if (sttr == "") {
            $("#pwd2 + span").html('');
        }
        for (var i = 0; i < sttr.length; i++) {
            var c = sttr.charCodeAt(i);
            if ((c >= 0x0001 && c <= 0x007e) || (0xff60 <= c && c <= 0xff9f)) {
                sum++;
            }
            else {
                sum += 2;
            }
        }
        if (sum < 4) {
            $("#pwd2 + span").html('<img src="/static/img/wrong.png"/>');
            $("#pwd2 + span").text("昵称长度小于4");
        }
        else if (sum > 14) {
            $("#pwd2 + span").html('<img src="/static/img/wrong.png"/>');
            $("#pwd2 + span").text("昵称长度大于14");
        } else {
            arr['usertitle'] = true;
            $("#pwd2 + span").html('<img src="/static/img/rightPic.png"/>');
            $("#pwd2 + span").text("昵称正确");
        }
    }
    $(document).ready(function () {
        $("#username").focusout(function () {
            $("#rgpspan1").html("");
            $.ajax({
                type: "POST",
                url: "/regcheck",
                data: {"username": $("#username").val()},
                success: function (evt) {
                    if (evt == 'ok') {
                        arr['username'] = true;
                        $("#username +span").html('<img src="/static/img/rightPic.png"/>ok');
                    } else {
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    if (XMLHttpRequest) {
                        var errorStr = XMLHttpRequest.responseText;
                        if (!errorStr)return;
                        var j = errorStr.substr(errorStr.indexOf("HTTPError:"));
                        var a = j.indexOf("(") + 1;
                        var b = j.indexOf(")") - a;
                        var str = j.substr(a, [b]);
                        if (str == "")return;
                        var c = str.charCodeAt(0);
                        if ((c >= 0x0001 && c <= 0x007e) || (0xff60 <= c && c <= 0xff9f)) {
                            return;
                        }
                        $("#username +span").html('<img src="/static/img/wrong.png"/>str');
                        arr['username'] = false;
                    }
                }
            });
        });
    });
    //发送验证码
    var wait;
    $("#js-auth-code-btn").click(function () {
        wait = 60;
        var mobile_number = $("#phone").val();
        var myreg = /^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1}))+\d{8})$/;
        if (!myreg.test(mobile_number)) {
            $("#phone + span").html('<img src="/static/img/rightPic.png" />手机号码格式不正确');
            $("#phone").focus();
            return false;
        }
        else {
            $(this).attr("href", "javascript:;").text("等待" + wait + "秒");
            time($(this));
            data['mobile_number'] = mobile_number;
            $.ajax({
                type: 'get',
                url: '/smscode',
                data: data,
                success: function (data) {

                }
            });
        }
    });

    function time(o) {
        if (wait == 0) {
            o.removeAttr("href");
            wait = 60;
            o.text("重新获取");
        } else {
            o.attr("href", "javascript:void(0)");
            o.text("等待" + wait + "秒");
            wait--;
            setTimeout(function () {
                        time(o)
                    },
                    1000)
        }
    }
    $("#pwd").focusout(function () {
        $("#pwd + span").html("");
        psskeydown1();
    });
    $("#pwd2").focusout(function () {
        $("#pwd2 + span").html("");
        psskeydown2();
    });
    $("#email").focusout(function () {
        $("#email + span").html("");
        email_ext($(this).val())
    });
    //提交注册
    function postmessage() {
        var selected = $("input[name='readme']").attr("checked") == true;
        if (!$("input[name='readme']").attr("checked")) {
            alert("请同意创业孵化平台用户注册协议");
            return false;
        }
        var data = {
            "username": $("#username").val(),
            "pwd": $("#pwd").val(),
            "pwd2": $("pwd2").val(),
            "role": $('select[name="role"]').val(),
            "email": $("#email").val(),
            "phone": $("#phone").val(),
            "msgcode": $("#msgcode").val(),
            "code": $("#code").val()
        };
        if (data['username'] == '' && data['pwd'] == '' && data['username'] == '') {
            return false;
        }
        jQuery.ajax({
            url: "/register",
            type: "post",
            data: data,
            success: function (msg) {
                var jsons = jQuery.parseJSON(msg);
                if (jsons.msg == "ok") {
                    //注册环信新用户
                    // emchat_regist();
                    window.location.href = '/login'
                }
                else {
                    alert(jsons.msg);
                }
            }

        })

    }
    var emchat_regist = function () {
        var user = $("#username").val();
        var pass = $("#pwd").val();
        var nickname = $("#username").val();
        if (user == '' || pass == '' || nickname == '') {
            alert("用户名/密码/昵称 不能为空");
            return;
        }
        var options = {
            username: user,
            password: pass,
            nickname: nickname,
            appKey: Easemob.im.config.appkey,
            success: function (result) {
                window.location.href = '/login'
            },
            error: function (e) {
                alert(e.error);
            },
            apiUrl: Easemob.im.config.apiURL
        };
        Easemob.im.Helper.registerUser(options);
    };

    $(function () {
        $('#parkHatchBtn').click(function () {
            $('body').css('overflow', 'hidden');
            $('._mask').fadeIn('fast');
            $('._alert').slideDown('fast');
        });

        $('#_cancel').click(function () {
            $('body').css('overflow', 'auto');
            $('._mask').fadeOut('fast');
            $('._alert').slideUp('fast');
        });
    });
</script>


{% end %}